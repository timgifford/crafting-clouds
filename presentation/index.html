<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Declarative Cloud Crafting with CloudFormation and Terraform</title>

    <meta name="description" content="">
    <meta name="author" content="Tim Gifford, Lean TECHniques, Inc.">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/league.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );






    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section data-background="https://media.giphy.com/media/LWPbocV2XJWo0/giphy.gif">
            <h1>Declarative Cloud Crafting</h1>
            <h3> with CloudFormation and Terraform</h3>
            <p>
                <small>Tim Gifford, Lean TECHniques, Inc.</small>
            </p>
        </section>

        <!--<section style="text-align: right;" data-background="https://media.giphy.com/media/tqiYB9X6goN68/giphy.gif">-->
        <section style="text-align: right;" data-background="https://media.giphy.com/media/9LFBOD8a1Ip2M/giphy.gif">
            <h3>Tim Gifford</h3>
            <h3>Agile/Lean</h3>
            <h3>DevOps</h3>
            <h3>Lean TECHniques</h3>


        </section>

        <section>
            <h2>Prelude</h2>
            <ul>
                <li>Informal</li>
                <li>Discussion and comments welcome</li>
                <li>Mobile phone policy</li>
                <ul>
                    <li>@timgifford</li>
                    <li>#awsdsm</li>
                </ul>
            </ul>
        </section>

        <section>
            <section>
                <h1>I'm curious...</h1>
            </section>
            <section>
                <h3>Does hot water freeze faster than cold water?<super>*</super></h3>

                <h4 class="fragment">Show of hands:</h4>
                <p class="fragment">Hot freezes faster?</p>
                <p class="fragment">Cold freezes faster?</p>
            </section>

            <section>
                <h3>Observations</h3>
                <ul>
                    <li>Aristotle - 650 BC</li>
                    <li>Sir Francis Bacon - 1620</li>
                    <li>René Descartes - 1637</li>
                </ul>
            </section>

            <section>
                <h3>Mpemba Effect</h3>

                <p>1963-1969</p>
                <p>"If you take two similar containers with equal volumes of water, one at 35 °C (95 °F) and the other at 100 °C (212 °F), and put them into a freezer, the one that started at 100 °C (212 °F) freezes first. Why?"</p>
            </section>

            <section>
                <h2>Why?</h2>
                <h3 class="fragment">We don't know</h3>
            </section>
        </section>

        <section>
            <h2>Overview</h2>
            <ul>
                <li>3 Styles</li>
                <li>Not Covered</li>
                <li>CloudFormation</li>
                <li>Terraform</li>
                <li>Extras</li>
                <li>Upcoming Events</li>
            </ul>
        </section>

        <section>
            <section>
                <h2>3 Styles</h2>
                <ul>
                    <li>Manual - using the online tools</li>
                    <li>Imperative - scripting the AWS CLI/SDK</li>
                    <li>Declarative - using tools like CloudFormation or Terraform</li>
                </ul>
            </section>

            <section data-background="https://media.giphy.com/media/70Asu3n7btVgk/giphy.gif">
                <h2>Why Declarative</h2>
                <ul>
                    <li>Scripted Infrastructure (IaC)</li>
                    <li>Resource Dependencies</li>
                    <li>Variation of Dude's Law  (Hussman)</li>
                        <ul>
                            <li>Why / How => What / How</li>
                        </ul>
                </ul>
            </section>

        </section>

        <section>
            <h2>Declarative Tools</h2>
            <ul>
                <li>AWS CloudFormation</li>
                <li>Hashicorp Terraform</li>
                <li>Docker</li>
            </ul>
        </section>


        <section data-background="https://media.giphy.com/media/DzIIiyZvSdzxu/giphy.gif">
            <section>
                <h2>Not covering</h2>
                <ul>
                    <li>Docker</li>
                    <li>Unit testing</li>
                    <li>Cross cloud</li>
                    <li>Code deployment</li>
                </ul>
            </section>

            <section>
                <h3>Configuration Management</h3>
                <ul>
                    <li>Chef</li>
                    <li>Puppet</li>
                    <li>Ansible</li>
                    <li>Salt</li>
                </ul>
            </section>

            <section>
                <h3>Imperative Scripting</h3>
                <ul>
                    <li>Python</li>
                        <ul>
                            <li><a href="https://github.com/boto/boto3">Boto3</a></li>
                            <li><a href="https://github.com/cloudtools/troposphere">Troposphere</a></li>
                        </ul>
                    <li>Bash/PowerShell</li>
                    <li>Ruby</li>
                    <ul>
                        <li><a href="http://opensource.envato.com/projects/stack_master.html">StackMaster</a></li>
                        <li><a href="http://www.sparkleformation.io/">SparkleFormation</a></li>
                    </ul>
                </ul>
            </section>
        </section>

        <section>
            <section data-background="img/cf-logo.png">
                <h1>Cloudformation</h1>
            </section>

            <section>
                <h2>Overview</h2>
                <ul>
                    <li>AWS managed service</li>
                    <li>Proprietary (Squared)</li>
                    <li>Multiple API Clients</li>
                    <ul>
                        <li>AWS CLI</li>
                        <li>AWS SDK</li>
                    </ul>
                </ul>
            </section>
        </section>

        <section>
            <section data-background="img/cf-logo.png">
                <h1>Cloudformation</h1>
                <h2>Terms</h2>
            </section>
            <section>
                <ul>
                    <li>Template</li>
                    <li>Stack</li>
                    <li>Resource</li>
                    <li>Change set</li>
                </ul>
            </section>
        </section>

        <section>
                <section data-background="img/cf-logo.png">
                    <h1>Cloudformation</h1>
                    <h2>Commands</h2>
                </section>
                <section>
                    <h2>validate-template</h2>

                    <pre><code class="hljs" data-trim contenteditable>
                    aws cloudformation validate-template \
                        --template-body file://app.yml
                    </code></pre>

                </section>
            <section>
                <h2>create-stack</h2>
                <pre><code class="hljs" data-trim contenteditable>
                aws cloudformation create-stack \
                    --stack-name crafting-cloud-cf \
                    --template-body file://app.yml \
                    --parameters file://app-params.json
                </code></pre>
            </section>

            <section>
                <h2>describe-stacks</h2>
                <pre><code class="hljs" data-trim contenteditable>
                aws cloudformation describe-stacks \
                    --stack-name crafting-cloud-cf
                </code></pre>
            </section>

            <section>
                <h2>update-stack</h2>

                Remove the security group and reference

                <pre><code class="hljs" data-trim contenteditable>
                aws cloudformation update-stack \
                    --stack-name crafting-cloud-cf \
                    --template-body file://app.yml \
                    --parameters file://app-params.json
                </code></pre>
            </section>

            <section>
                <h2>delete-stack</h2>
                <pre><code class="hljs" data-trim contenteditable>
                aws cloudformation delete-stack \
                    --stack-name crafting-cloud-cf
                </code></pre>
            </section>

            <section>
                <h2>deploy (new)</h2>
                <p>Introduced in v1.11.68</p>
                <p>2 for 1: create-change-set AND execute-change-set</p>
                <pre><code class="hljs" data-trim contenteditable>
                    aws cloudformation deploy \
                    --stack-name crafting-cloud-cf \
                    --template-file ./app.yml \
                    --parameter-overrides VPC=vpc-984048fa Subnet=subnet-7bb4fe3d
                </code></pre>
            </section>

            <section>
                <h2>deploy (update)</h2>

                <p>Create with Change set</p>

                <p>Modify the ami</p>
                <pre><code class="hljs" data-trim contenteditable>
                    aws cloudformation deploy \
                    --no-execute-changeset \
                    --stack-name crafting-cloud-cf \
                    --template-file ./app.yml \
                    --parameter-overrides VPC=vpc-984048fa Subnet=subnet-7bb4fe3d
                </code></pre>
            </section>

            <section>
                <h2>wait</h2>
                <ul>
                    <li>change-set-create-complete</li>
                    <li>stack-create-complete</li>
                    <li>stack-delete-complete</li>
                    <li>stack-exists</li>
                    <li>stack-update-complete</li>
                </ul>

                <pre><code class="hljs" data-trim contenteditable>
                    aws cloudformation wait stack-exists \
                    --stack-name crafting-cloud-cf
                </code></pre>
            </section>

            <section data-background="https://media.giphy.com/media/l0HlRnAWXxn0MhKLK/giphy.gif">
                <h2>Questions</h2>
            </section>

        </section>

        <!-- #0f002e -->
        <!-- #370099 -->
        <section data-background-color="#0f002e">
            <!--Terraform-->
            <section data-background="img/terraform-title.png" >
            </section>

            <section>
                <h2>Overview</h2>

                <ul>
                    <li>Single `terraform` binary</li>
                    <ul>
                        <li>CLI only</li>
                    </ul>
                    <li>Written in Go (golang)</li>
                    <li>Open source</li>
                    <li>Maintained by Hashicorp</li>
                </ul>

            </section>

            <section>
                <h1>Terraform</h1>
                <h2>Terms</h2>
            </section>
            <section>
                <h2>Providers</h2>

                <p>Cloud providers, Chef, any noun for infrastructure</p>

                <p>Huge list of <a href="https://www.terraform.io/docs/providers/index.html" target="_blank">providers</a></p>

            </section>

            <section>
                <h2>State</h2>

                <p>A snapshot of the currently deployed resources and their configuration.</p>
                <p>Stored in <strong>terraform.tfstate</strong> file.</p>
                <p>Initial designs of TF used AWS Tags to managed the state, but not all providers support tags</p>
            </section>

            <section>
                <h2>Backend</h2>
                <p>Place to store your state files.</p>
                <p>Some support locking and fewer support remote operations</p>
            </section>

            <section>
                <h2>Taint</h2>
                <p>Mark a resource to be destroyed</p>
            </section>

        </section>




        <section data-background-color="#0f002e">
            <!--Terraform-->
            <section>
                <h1>Terraform</h1>
                <h2>Commands</h2>
            </section>
            <section>
                <h2>validate</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    terraform validate
                    </code></pre>
            </section>

            <section>
                <h2>plan</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    terraform plan -var-file terraform.tfvars
                    </code></pre>

                <p>Note: The default is <i>terraform.tfvars</i></p>
            </section>

            <section>
                <h2>apply</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    terraform apply -var-file terraform.tfvars
                    </code></pre>
            </section>

            <section>
                <h2>update?</h2>

                <p>No special command: plan and apply</p>
                <p>Everything is an "upsert"</p>
            </section>

            <section>
                <h2>destroy</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    terraform plan -destroy
                    </code></pre>

                <pre><code class="hljs" data-trim contenteditable>
                    terraform destroy -var-file terraform.tfvars
                    </code></pre>
            </section>


            <section>
                <h1>Questions</h1>
            </section>

            <section data-background="https://media.giphy.com/media/hEc4k5pN17GZq/giphy.gif">

            </section>
        </section>


        <section>
            <section>
                <h1>Extras</h1>
            </section>

            <section data-background-color="#0f002e">
                <h2>Terraform IntelliJ Plugin</h2>

            </section>

            <section data-background-color="#0f002e">
                <h2>Terraform Templates</h2>
                <p>index.html.tpl</p>
<pre><code class="hljs" data-trim contenteditable>
&lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;${message}&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
                <p>main.tf</p>
<pre><code class="hljs" data-trim contenteditable>
data "template_file" "index-page" {
  template = "${file("index.html.tpl")}"

  vars {
    message = "Terraform"
  }
}

output "rendered" {
  value = "${data.template_file.index-page.rendered}"
}
</code></pre>

            </section>


            <section data-background-color="#0f002e">
                <h2>Terraform Graph</h2>

                <pre><code class="hljs" data-trim contenteditable>
                    terraform graph | dot -Tpng > graph.png | open graph.png
                    </code></pre>
            </section>

            <!--Terraform-->
            <section data-background-color="#0f002e">
                <h2>TF + CF</h2>
                <p>Create Cloudformation Stack from Terraform</p>

                <pre><code class="hljs" data-trim contenteditable>
resource "aws_cloudformation_stack" "app-stack" {
  name = "crafting-clouds-tfcf"

  parameters {
    VPC    = "${var.vpc}"
    Subnet = "${var.subnet}"
  }

  template_url =
    "https://${aws_s3_bucket.crafting-clouds.bucket_domain_name}/
                        ${aws_s3_bucket_object.cf-stack.id}"
}
                    </code></pre>
            </section>

            <section>
                <h2>CloudFormation Comments</h2>
<pre><code class="hljs" data-trim contenteditable>
# Use Mapping for account specific settings
Mappings:
  Account:
    "397713163394":
      name: "devl"
      ami:  "ami-0b33d91d"

    "999999999999":
      name: "prod"
      ami:  "ami-b63769a1"

</code></pre>

                <p>Since September 2016!</p>
                <p class="fragment">Only in YAML files</p>
            </section>

            <section>
                <h2>CloudFormation Designer</h2>

                <img src="img/reddit-cf-designer.png"/>
            </section>
        </section>

        <section>

            <section>
                <h1>Events</h1>
            </section>

            <section>
                <h2>Lean Coffee</h2>
                <h4>Monthly - 3rd Thursday @ 7:00 AM</h4>
                <h4>Iowa Machine Shed</h4>
                <p>www.agileiowa.org</p>
            </section>

            <section>
                <h2>CIJUG</h2>
                <h4>100 Days of Scala</h4>
                <h4>Greg Hazen/Tim Gifford</h4>
                <h4>May</h4>
                <p>http://cijug.net</p>
            </section>

            <section>
                <h2>dsmAgile</h2>
                <h3>Friday, October 13</h3>
                <h4>$100</h4>
                <p>dsmagile.agileiowa.org</p>
            </section>

            <section>
                <h1>DevOps Days</h1>
                <h2>Des Moines</h2>

                <h4 class="fragment">Exploratory Committee</h4>
                <ul class="fragment">
                    <li>Speakers</li>
                    <li>Venue</li>
                    <li>Employers</li>
                    <li>Sponsors</li>
                    <li>Promotions</li>
                </ul>
                <p class="fragment">Interested? Contact me</p>
            </section>

        </section>

        <section>
            <h1>Thanks</h1>
            <p>Tim Gifford</p>
            <p>tgifford@leantechniques.co</p>

            <a href="https://github.com/timgifford/crafting-clouds">https://github.com/timgifford/crafting-clouds</a>
        </section>

    </div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});







</script>

</body>
</html>
